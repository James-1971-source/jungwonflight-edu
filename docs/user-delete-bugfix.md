# 교육생 삭제 기능 버그 해결 내역

## 문제 현상
- 동영상 플랫폼에서 교육생(사용자) 삭제 시, 실제로 DB에서는 삭제가 이루어지지 않거나, 항상 "이미 삭제된 사용자"라는 메시지가 표시됨
- 프론트엔드에서는 삭제 성공 메시지가 뜨지 않거나, 삭제가 정상적으로 반영되지 않음

## 원인 분석
1. **ORM(Drizzle)에서 delete 쿼리의 반환값이 항상 0**
   - PostgreSQL 환경에서 `db.delete(...).where(...);`의 반환값이 삭제된 행의 수(rowCount, changes 등)를 제공하지 않음
   - 기존 코드에서는 반환값이 0이면 삭제 실패로 간주하여 404를 반환함
2. **실제로는 삭제가 되었음에도 불구하고, 반환값이 0이어서 항상 404가 반환됨**
   - 프론트엔드에서는 항상 "이미 삭제된 사용자" 메시지가 뜨는 현상 발생

## 최종 해결 방법
- **deleteUser 함수에서 delete 쿼리의 반환값을 신뢰하지 않고, 삭제 후 getUser로 실제로 DB에 사용자가 남아있는지 재확인**
- 삭제 후 getUser로 해당 사용자가 DB에 남아있지 않으면 true(삭제 성공), 남아있으면 false(삭제 실패)로 처리

### 최종 적용 코드
```ts
// server/storage.ts
async deleteUser(id: number): Promise<boolean> {
  await db.delete(users).where(eq(users.id, id));
  // 삭제 후 실제로 존재하는지 재확인
  const user = await this.getUser(id);
  return !user;
}
```

## 결과
- 이제 실제로 삭제가 성공하면 200(성공) 메시지가,
- 이미 삭제된 사용자를 삭제하면 404(사용자를 찾을 수 없습니다)가
정확하게 동작함
- 프론트엔드에서도 삭제 성공/실패 메시지가 올바르게 표시됨

---

**이 문서는 교육생(사용자) 삭제 기능의 버그를 해결한 과정을 기록한 문서입니다.** 